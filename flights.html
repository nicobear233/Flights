<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>航线图</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
    <script type="text/javascript" src="./world.js"></script>
    <script src="./vue.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0
        }
        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        #main {
            width: 100%;
            height: 100%;
            margin: 0px auto;
            border: 1px solid #ddd;
        }
        /*默认长宽比0.75*/
    </style>
</head>
<body>
<div id="main">
</div>
<!--
<script type="text/javascript">
    var geoCoordMap = {
        "Beijing": [116.407395, 39.904211]
    };

    var rawData = [];
 
    var dataList = [
        {name: "冰岛", value: 0},
        {name: '中国', value: randomValue()},
        {name: '俄罗斯', value: randomValue()},
        {name: '美国', value: randomValue()},
        {name: '英国', value: randomValue()},
        {name: '澳大利亚', value: randomValue()},
        {name: '日本', value: randomValue()}
    ];
 
    function makeMapData(rawData) {
        var mapData = [];
        for (var i = 0; i < rawData.length; i++) {
        }
        return mapData;
    };
 
    var myChart = echarts.init(document.getElementById('main'));
 
    function randomValue() {
        return Math.round(Math.random() * 1000);
    }
 
    option = {
        backgroundColor: new echarts.graphic.RadialGradient(0.5, 0.5, 0.4, [{
            offset: 0,
            color: '#4b5769'
        }, {
            offset: 1,
            color: '#404a59'
        }]),
        title: {
            text: 'Prices and Earnings 2012',
            subtext: 'data from macrofocus',
            sublink: 'https://www.macrofocus.com/public/products/infoscope/datasets/pricesandearnings/',
            left: 'center',
            top: 5,
            itemGap: 0,
            textStyle: {
                color: '#eee'
            },
            z: 200
        },
        tooltip: {
            trigger: 'item',
            formatter: function (params) {
                var value = (params.value + '').split('.');
                value = value[0].replace(/(\d{1,3})(?=(?:\d{3})+(?!\d))/g, '$1,') + '.' + value[1];
                return params.seriesName + '<br/>' + params.name + ' : ' + value;
            }
        },
        visualMap: {
            min: 0,
            max: 1500,
            left: 'left',
            top: 'bottom',
            text: ['高', '低'],//取值范围的文字
            inRange: {
                color: ['#e0ffff', '#006edd']//取值范围的颜色
            },
            show: true//图注
        },
        geo: {
            map: 'world',
            roam: true,//不开启缩放和平移
            zoom: 1.1,//视角缩放比例
            label: {
                normal: {
                    show: false,
                    fontSize: '10',
                    color: 'rgba(0,0,0,0.7)'
                }
            },
            itemStyle: {
                normal: {
                    borderColor: 'rgba(0, 0, 0, 0.2)'
                },
                emphasis: {
                    areaColor: '#F3B329',//鼠标选择区域颜色
                    shadowOffsetX: 0,
                    shadowOffsetY: 0,
                    shadowBlur: 20,
                    borderWidth: 0,
                    shadowColor: 'rgba(0, 0, 0, 0.5)'
                }
            }
        },
        series: [
            {
                name: '信息量',
                type: 'map',
                geoIndex: 0,
                // data: dataList
            },
            {
                name: 'Prices and Earnings 2012',
                type: 'scatter',
                coordinateSystem: 'geo',
                symbolSize: 8,
                // data: makeMapData(rawData),
                activeOpacity: 1,
                label: {
                    formatter: '{b}',
                    position: 'right',
                    show: false
                },
                symbolSize: 10,
                // symbolSize: function (data) {
                //     return Math.max(5, data[2] / 5);
                // },
                itemStyle: {
                    borderColor: '#fff',
                    color: '#577ceb',
                },
                emphasis: {
                    label: {
                        show: true
                    }
                }
            },
        ]
    };
    myChart.setOption(option);
    myChart.on('click', function (params) {
        alert(params.name);
    });
 
    /*  setTimeout(function () {
          myChart.setOption({
              series : [
                  {
                      name: '信息量',
                      type: 'map',
                      geoIndex: 0,
                      data:dataList
                  }
              ]
          });
      },1000)*/
</script>
-->

<script>
    let Flights=new Vue({
        el: "#main",
        data: {
            geoCoordMap: {
                "Angola":[17.87,-11.20],
                "Afghanistan":[67.71,33.94],
                "Albania":[20.17,41.15],
                "Algeria":[1.66,28.03],
                "Andorra":[1.52,42.51],
                "Anguilla":[-63.07,18.22],
                "Argentina":[-63.62,-38.42],
                "Armenia":[45.04,40.07],
                "Ascension":[-90.94,30.20],
                "Australia":[133.78,-25.27],
                "Austria":[14.55,47.52],
                "Azerbaijan":[47.58,40.14],
                "Bahamas":[-77.40,25.03],
                "Bahrain":[50.56,26.07],
                "Bangladesh":[90.36,23.68],
                "Barbados":[-59.54,13.19],
                "Belarus":[27.95,53.71],
                "Belgium":[4.47,50.50],
                "Belize":[-88.50,17.19],
                "Benin":[2.32,9.31],
                "Bermuda Is":[-64.75,32.31],
                "Bolivia":[-63.59,-16.29],
                "Botswana":[24.68,-22.33],
                "Brazil":[-51.93,-14.24],
                "Brunei":[114.73,4.54],
                "Bulgaria":[25.49,42.73],
                "Burkina-faso":[-1.56,12.24],
                "Burma":[95.96,21.92],
                "Burundi":[29.92,-3.37],
                "Cameroon":[12.35,7.37],
                "Canada":[-106.35,56.13],
                "Cayman Is":[-117.64,33.64],
                "Central African Republic":[20.94,6.61],
                "Chad":[18.73,15.45],
                "Chile":[-71.54,-35.68],
                "China":[104.20,35.86],
                "Colombia":[-74.30,4.57],
                "Cook Is":[-90.49,47.61],
                "Costa Rica":[-83.75,9.75], 
                "Croatia":[15.2,45.1],
                "Cuba":[-77.78,21.52],
                "Cyprus":[33.43,35.13],
                "Czech Republic":[15.47,49.82], 
                "Denmark":[9.50,56.26],
                "Djibouti":[42.59,11.83],
                "Dominica Rep":[-0.19,51.52], 
                "Ecuador":[-78.18,-1.83],
                "Egypt":[30.80,26.82],
                "EI Salvador":[-88.90,13.79], 
                "Estonia":[25.01,58.60],
                "Ethiopia":[40.49,9.15],
                "Fiji":[178.07,-17.71],
                "Finland":[25.75,61.92],
                "France":[2.21,46.23],
                "French Guiana":[-53.13,3.93], 
                "Gabon":[11.61,-0.80],
                "Gambia":[-15.31,13.44],
                "Georgia":[-82.90,32.17],
                "Germany":[10.45,51.17], 
                "Ghana":[-1.02,7.95],
                "Gibraltar":[-5.35,36.14],
                "Greece":[21.82,39.07],
                "Grenada":[-61.68,12.12], 
                "Guam":[144.79,13.44],
                "Guatemala":[-90.23,15.78], 
                "Guinea":[-9.70,9.95],
                "Guyana":[-58.93,4.86],
                "Haiti":[-72.29,18.97],
                "Honduras":[-86.24,15.20],
                "Hong Kong":[114.11,22.40], 
                "Hungary":[19.50,47.16],
                "Iceland":[-19.02,64.96],
                "India":[78.96,20.59],
                "Indonesia":[113.92,-0.79], 
                "Iran":[53.69,32.43],
                "Iraq":[43.68,33.22],
                "Ireland":[-8.24,53.41],
                "Israel":[34.85,31.05],
                "Italy":[12.57,41.87],
                "Ivory Coast":[-5.55,7.54],
                "Japan":[138.25,36.20],
                "Jordan":[36.24,30.59],
                "Kampuchea":[105.46,12.00], 
                "Kazakstan":[66.92,48.02],
                "Kenya":[37.91,-0.02],
                "Korea":[127.98,37.66],
                "Kuwait":[47.48,29.31],
                "Kyrgyzstan":[74.77,41.20], 
                "Laos":[102.50,19.86],
                "Latvia":[24.60,56.88],
                "Lebanon":[35.86,33.85],
                "Lesotho":[28.23,-29.61],
                "Liberia":[-9.43,6.43],
                "Libya":[17.23,26.34],
                "Liechtenstein":[9.56,47.17], 
                "Lithuania":[23.88,55.17], 
                "Luxembourg":[6.13,49.82], 
                "Macao":[113.54,22.20],
                "Madagascar":[46.87,-18.77], 
                "Malawi":[34.30,-13.25],
                "Malaysia":[101.98,4.21],
                "Maldives":[73.54,1.98],
                "Mali":[-4.00,17.57],
                "Malta":[14.38,35.94],
                "Mariana Is":[-43.41,-20.37], 
                "Martinique":[-61.02,14.64],
                "Mauritius":[57.55,-20.35],
                "Mexico":[-102.55,23.63],
                "Monaco":[7.42,43.74],
                "Mongolia":[103.85,46.86], 
                "Montserrat Is":[-62.19,16.74], 
                "Morocco":[-7.09,31.79],
                "Mozambique":[35.53,-18.67], 
                "Namibia":[18.49,-22.96], 
                "Nauru":[166.93,-0.52],
                "Nepal":[84.12,28.39],
                "Netheriands Antilles":[-68.26,12.20], 
                "Netherlands":[5.29,52.13], 
                "New Zealand":[174.89,-40.90], 
                "Nicaragua":[-85.21,12.87], 
                "Niger":[8.08,17.61],
                "Nigeria":[8.68,9.08],
                "North Korea":[127.51,40.34],
                "Oman":[55.98,21.47],
                "Pakistan":[69.35,30.38],
                "Panama":[-80.78,8.54],
                "Papua New Cuinea":[143.96,-6.31], 
                "Paraguay":[-58.44,-23.44], 
                "Peru":[-75.02,-9.19],
                "Philippines":[121.77,12.88], 
                "Poland":[19.15,51.92],
                "French Polynesia":[-149.41,-17.68], 
                "Portugal":[-8.22,39.40],
                "Puerto Rico":[-66.59,18.22], 
                "Qatar":[51.18,25.35],
                "Reunion":[55.54,-21.12], 
                "Romania":[24.97,45.94],
                "Russia":[105.32,61.52],
                "Saint Lueia":[-60.98,13.91], 
                "Saint Vincent":[7.64,45.75], 
                "Samoa Eastern":[-121.83,37.35], 
                "Samoa Western":[-124.15,40.80], 
                "San Marino":[12.46,43.94],
                "Sao Tome and Principe":[6.61,0.19], 
                "Saudi Arabia":[45.08,23.89], 
                "Senegal":[-14.45,14.50],
                "Seychelles":[55.49,-4.68], 
                "Sierra Leone":[-11.78,8.46], 
                "Singapore":[103.82,1.35], 
                "Slovakia":[19.70,48.67],
                "Slovenia":[15.00,46.15],
                "Solomon Is":[-97.37,38.92], 
                "Somali":[46.20,5.15],
                "South Africa":[22.94,-30.56], 
                "Spain":[-3.75,40.46],
                "Sri Lanka":[80.77,7.87],
                "St.Lucia":[-60.98,13.91],
                "St.Vincent":[-91.06,29.99], 
                "Sudan":[30.22,12.86],
                "Suriname":[-56.03,3.92], 
                "Swaziland":[31.47,-26.52], 
                "Sweden":[18.64,60.13],
                "Switzerland":[8.23,46.82], 
                "Syria":[39.00,34.80],
                "Taiwan":[120.96,23.70],
                "Tajikstan":[71.28,38.86],
                "Thailand":[100.99,15.87], 
                "Togo":[0.82,8.62],
                "Tonga":[-175.20,-21.18],
                "Trinidad and Tobago":[-61.22,10.69], 
                "Tunisia":[9.54,33.89],
                "Turkey":[35.24,38.96],
                "Turkmenistan":[59.56,38.97], 
                "Uganda":[32.29,1.37],
                "Ukraine":[31.17,48.38],
                "United Arab Emirates":[53.85,23.42], 
                "United Kingdom":[-3.44,55.38], 
                "United States":[-95.71,37.09], 
                "Uruguay":[-55.77,-32.52], 
                "Uzbekistan":[64.59,41.38], 
                "Venezuela":[-66.59,6.42], 
                "Vietnam":[108.28,14.06], 
                "Yemen":[48.52,15.55],
                "Yugoslavia":[121.02,14.48], 
                "Zimbabwe":[29.15,-19.02], 
                "Zaire":[21.76,-4.04],
                "Zambia":[27.85,-13.13]
            },
            LocaData: [
            ], 
            allData: [
                ["Afghanistan","China","2022/2/28 10:40:00","2022/3/1 10:51:00"],
                ["India","China","2022/2/28 9:40:00","2022/3/1 11:50:00"],
                ["United States","China","2022/2/28 9:30:00","2022/2/28 20:50:00"],
                ["France","China","2022/2/28 14:30:00","2022/2/28 18:50:00"],
                ["United Kingdom","China","2022/2/28 15:05:00","2022/3/1 15:24:00"],
                ["Spain","China","2022/2/27 14:30:00","2022/3/1 16:50:00"],
                ["Australia","China","2022/2/28 10:40:00","2022/3/1 10:51:00"],
                ["Brazil","China","2022/2/28 9:40:00","2022/3/1 11:50:00"],
                ["Canada","China","2022/2/28 9:30:00","2022/2/28 20:50:00"],
                ["Colombia","China","2022/2/28 14:30:00","2022/2/28 18:50:00"],
                ["Germany","China","2022/2/28 15:05:00","2022/3/1 15:24:00"],
                ["Hong Kong","China","2022/2/27 14:30:00","2022/3/1 16:50:00"]
            ],
            planePath: 'path://M1705.06,1318.313v-89.254l-319.9-221.799l0.073-208.063c0.521-84.662-26.629-121.796-63.961-121.491c-37.332-0.305-64.482,36.829-63.961,121.491l0.073,208.063l-319.9,221.799v89.254l330.343-157.288l12.238,241.308l-134.449,92.931l0.531,42.034l175.125-42.917l175.125,42.917l0.531-42.034l-134.449-92.931l12.238-241.308L1705.06,1318.313z',
            timer: null
        },
        methods:{
            loca(){
                let series=[], regions=[];
                this.LocaData.forEach((item, i) =>{
                    regions.push({
                        name: item[0],  // 对应的是json文件中的名称
                            selected:false,
                            itemStyle: {
                                normal: {
                                    areaColor: '#F3B329',
                                    shadowBlur: 20,
                                    shadowColor: 'rgba(0, 0, 0, 0.5)'
                                },
                            },
                            label: {
                                normal: {
                                    show: true,
                                    fontSize: '12',
                                    color: 'rgba(0,0,0,0.7)'
                                }
                            },
                    }),
                    series.push({
                            type: 'lines', //用于带有起点和终点信息的线数据的绘制，主要用于地图上的航线，路线的可视化。
                            zlevel: 2,
                            symbol: ['none', 'arrow'], 
                            effect: { //线特效的配置
                                show: true,
                                period: 15, //特效动画的时间
                                symbol: this.planePath,
                                trailLength: 0.7, //特效尾迹的长度。取从 0 到 1 的值，数值越大尾迹越长。
                                color: '#fff',
                                symbolSize: 7, //特效标记的大小，可以设置成诸如 10 这样单一的数字，也可以用数组分开表示高和宽，例如 [20, 10] 表示标记宽为20，高为10。
                                // loop: false
                            },
                            lineStyle: {
                                normal: {
                                    color: '#6fa8dc',
                                    // width: 0,
                                    width: 1,
                                    opacity: 0.6,
                                    curveness: 0.2, //边的曲度，支持从 0 到 1 的值，值越大曲度越大
                                }
                            },
                            label: {
                                show: true,
                                position: 'middle',
                                fontSize: 14,
                                formatter: ""+this.convertTime(item)[0].value[2]
                            },
                            data: this.convertData(item) //线数据集。
                        },
/*
                        {
                            type: 'lines',
                            zlevel: 2,
                            symbol: ['none', 'arrow'], //线两端的标记类型，可以是一个数组分别指定两端
                            symbolSize: 8,
                            effect: {
                                show: true,
                                period: 15,
                                trailLength: 0,
                                symbol: this.planePath,
                                symbolSize: 10
                            },
                            lineStyle: {
                                color: '#46bee9',
                                width: 0,
                                opacity: 0.6,
                                curveness: 0.2
                            },
                            label: {
                                show: true,
                                position: 'middle',
                                formatter: this.convertTime(item)[2]
                            },
                            data: this.convertData(item)
                        },  
*/
                        {
                            type: 'effectScatter', //带有涟漪特效动画的散点（气泡）图。利用动画特效可以将某些想要突出的数据进行视觉突出。
                            coordinateSystem: 'geo', //该系列使用的坐标系
                            zlevel: 1,
                            rippleEffect: { //涟漪特效相关配置
                                brushType: 'stroke'
                            },
                            label: { //图形上的文本标签，可用于说明图形的一些数据信息，比如值，名称等
                                show: true,
                                position: 'bottom',
                                fontSize: 12,
                                formatter: '{@[3]}'
                            },
                            symbolSize: function (val) { //标记的大小
                                return 10 / val[2];
                            },
                            itemStyle: {
                                color:  '#46bee9'
                            },
                            data: this.convertTime(item)
                        },
                    );
                });
                regions.push({
                    name: "China",  // 对应的是json文件中的名称
                        // selected:false,
                         itemStyle: {
                            normal: {
                                areaColor: '#F3B329',
                                shadowBlur: 20,
                                shadowColor: 'rgba(0, 0, 0, 0.5)'
                            },
                        },
                        label: {
                            normal: {
                                show: true,
                                fontSize: '12',
                                color: 'rgba(0,0,0,0.7)'
                            }
                        },
                })
                return [series, regions];
            },
            selectedData() {
                var LocaData = [];
                this.allData.forEach((item, i) =>{
                    if(new Date(item[2])<new Date() && new Date(item[3])>new Date()) {
                        LocaData.push(item);
                    }
                })
                return LocaData;
            },
            convertData(data) {
                var res = [];
                var fromCoord = this.geoCoordMap[data[0]]; //始发地
                var toCoord = this.geoCoordMap[data[1]]; //目的地
                if (fromCoord && toCoord) {
                    res.push({
                        fromName: data[0],
                        toName: data[1],
                        coords: [fromCoord, toCoord] //一个包含两个到多个二维坐标的数组。在 polyline 设置为 true 时支持多于两个的坐标。
                    });
                }
                return res;
            },
            convertTime(data) {
                var res = [];
                var last_time = Math.ceil((new Date(data[3]).getTime() - new Date().getTime())/ 60000);
                var value = this.geoCoordMap[data[0]].concat(last_time);
                console.log(typeof(data[3]))
                console.log(data[3].length-2)
                res.push({
                    name: data[0],
                    value: data[3].toString().substring(5,data[3].length-2)
                });
                return res;
            },
            createLine(seriesData, regionsData){
                console.log(seriesData)
                console.log(regionsData)
                let myChart = echarts.init(document.getElementById('main'));
                myChart.setOption({
                    backgroundColor:"#404a59", //设置整体背景色
                    title : { //标题设置
                        text: 'Flights',
                        left: 'center',
                        textStyle: {
                            color: '#fff',
                            fontFamily:"Monospace",
                            fontWeight:"lighter"
                        },
                    },
                    geo: {
                        map: 'world',
                        roam: true, //不开启缩放和平移
                        zoom: 1.1, //视角缩放比例
                        label: {
                            normal: {
                                show: false,
                                fontSize: '10',
                                color: 'rgba(0,0,0,0.7)'
                            }
                        },
                        itemStyle: {
                            normal: {
                                borderColor: 'rgba(0, 0, 0, 0.2)'
                            },
                            emphasis: {
                                areaColor: '#F3B329', //鼠标选择区域颜色
                                shadowOffsetX: 0,
                                shadowOffsetY: 0,
                                shadowBlur: 20,
                                borderWidth: 0,
                                shadowColor: 'rgba(0, 0, 0, 0.5)'
                            }
                        },
                        regions: regionsData
                    },
                    series: seriesData
                })
            },
            reload(){
                this.LocaData = this.selectedData();
                this.createLine(this.loca()[0],this.loca()[1]);
                this.$forceUpdate();
            },
        },
        mounted(){
            this.reload();
            this.timer = setInterval(() =>{
                setTimeout(this.reload(), 0)
            }, 1000*60)
        },
        beforeDestroy(){
            clearInterval(this.timer);
            this.timer = null;
        }
    });
</script>

</body>
</html>
